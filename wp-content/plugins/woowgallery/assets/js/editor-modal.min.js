window.WoowGalleryAdmin=window.WoowGalleryAdmin||{l10n:{}},function(e,t,s){let i=window.WoowGalleryAdmin,l=null,o=new Vue({el:"#woowgallery-modal",data:{content:[],selected:[],selected_last_item:null,search_term:"",page:1,pages:1,per_page:i.l10n.per_page,loading:!1,inserting:!1,frame_title:"",menu_toggle:!1,wg_width:"100",wg_width_unit:"%",wg_align:"center",time:null,modal_type:null,restbase:null,get_post_type:null,prepend_mode:i.l10n.selection_prepend,hide_selected:!1,multiselect:!1,openModalCallback:null,modalIframeSrc:null,previous_screen:null},computed:{media_ids:function(){return t.pluck(this.content,"id")},gallery_posttype_ids:function(){return"shortcode"===this.modal_type||"block"===this.modal_type?[]:t.pluck(t.filter(i.Gallery.gallery,e=>e.subtype===this.get_post_type),"id")},selected_last:function(){return t.last(this.selected)}},watch:{selected_last:function(e){this.selected_last_item=e?t.find(this.content,t=>t.id===e):null},search_term:function(e){(e.length>=3||""===e)&&(this.time&&clearTimeout(this.time),this.time=setTimeout(()=>{this.getPosts(!0)},1e3))},page:function(e){this.getPosts()},pages:function(e){e<this.page&&(this.page=e||1)},prepend_mode:function(e){i.l10n.selection_prepend=e},hide_selected:function(e){let t=!!e&&this.gallery_posttype_ids;this.getPosts(!0,t)},get_post_type:function(e){this.rest_base=i.post_types[e].base,this.content=[],this.selected=[],this.search_term="";let t=!!this.hide_selected&&this.gallery_posttype_ids;this.getPosts(!0,t)}},filters:{mediaDate:function(e){return new Date(e).toLocaleString()},mediaTags:function(e){return e.length?s.sprintf(s.__("Tags: %s","woowgallery"),e.join(", ")):""}},mounted:function(){let t=this;e(document).on("click",".woowgallery-modal-button",function(){const s=e(this).data("modal"),i=e(this).data("posttype"),l=e(this).attr("title");t.openModal(s,i,l)})},methods:{openModal:function(e,t,s,i){if(this.frame_title=s,this.multiselect=!("shortcode"===e||"block"===e),e!==this.modal_type||t!==this.get_post_type)this.content=[],this.modal_type=e,this.get_post_type=t;else if(0===this.content.length){let e=!!this.hide_selected&&this.gallery_posttype_ids;this.getPosts(!0,e)}this.$el.classList.add("woowgallery-modal-active"),"function"==typeof i&&(this.openModalCallback=i)},createModal:function(e,t,s,l){l&&(this.previous_screen={frame_title:this.frame_title,modal_type:this.modal_type,get_post_type:this.get_post_type}),this.frame_title=s,this.modalIframeSrc=t?i.editModalSrc+"&post="+t+"&action=edit":i.editModalSrc+"&post_type="+e,this.$el.classList.add("woowgallery-modal-active")},getPosts:function(s,o){this.get_post_type&&(l&&l.abort(),this.menu_toggle=!1,this.loading=!0,l=e.ajax({url:i.wpApiRoot+"wp/v2/"+this.rest_base,method:"GET",beforeSend:e=>{e.setRequestHeader("X-WP-Nonce",i.wpApiNonce)},data:{context:"view",status:["future","publish","private"],per_page:this.per_page,page:s?1:this.page,search:this.search_term,exclude:o||[],_fields:"wg_data",_post_type:this.get_post_type}}).done((e,i,o)=>{l=null;let n=t.compact(t.pluck(e,"wg_data"));if(!n.length)return this.content=[],this.pages=1,void(this.loading=!1);let a=t.indexBy(n,"id");window.woowgallery_content_indexed={...window.woowgallery_content_indexed,...a},s&&(this.page=1),this.content=n,this.pages=o.getResponseHeader("X-WP-TotalPages")||1,this.loading=!1}))},insert:function(){if(this.selected_last){if("block"===this.modal_type)wp.blockEditor&&(this.openModalCallback&&this.openModalCallback(this.selected_last_item),i.blockProps&&i.blockProps.setAttributes({id:this.selected_last,align:this.wg_align,posttype:this.selected_last_item.subtype,width:{value:this.wg_width,unit:this.wg_width_unit}}));else if("shortcode"===this.modal_type){let e,t,s="";t=`id="${this.selected_last}"`,"100"===this.wg_width&&"%"===this.wg_width_unit||(s+=` width="${this.wg_width}${this.wg_width_unit}"`),"center"!==this.wg_align&&(s+=` align="${this.wg_align}"`),e=`[${this.get_post_type} ${t}${s}]`,wp.media.editor.insert(e)}else if("woowgallery"===this.modal_type){let t=this.content.filter(e=>this.selected.indexOf(e.id)>-1);e(document).trigger("woowgalleryInsertMedia",[this,t])}this.modalClose()}},loadPreviousScreen:function(){this.modalIframeSrc=null,this.openModalCallback=null,this.modal_type=this.previous_screen.modal_type,this.frame_title=this.previous_screen.frame_title,this.get_post_type=this.previous_screen.get_post_type,this.previous_screen=null},mediaTitle:function(e){return"private"===e.status?s.sprintf(s.__("%s - Private","woowgallery"),e.title):"future"===e.status?s.sprintf(s.__("%s - Scheduled","woowgallery"),e.title):e.title},mediaCount:function(e){let t=parseInt(e.count,10);return t?"woowgallery-album"===e.subtype?s.sprintf(s._n("%d Gallery","%d Galleries",t,"woowgallery"),t):s.sprintf(s._n("%d Media Item","%d Media Items",t,"woowgallery"),t):""},modalClose:function(){this.selected=[],this.search_term="",this.modalIframeSrc=null,this.openModalCallback=null,this.previous_screen=null,this.$el.classList.remove("woowgallery-modal-active")},showSelectSwitchers:function(){return"woowgallery"===this.modal_type&&this.content.length&&i.Gallery&&i.Gallery.media_ids&&i.Gallery.media_ids.length},selectedItemClasses:function(e){let t=[];return this.inGallery(e)?t.push("selected","woowgallery-selected"):this.isSelected(e)&&t.push("selected"),this.selected_last===e&&t.push("selected-last"),t},toggleSelectItem:function(e,t){t&&t.preventDefault(),this.isSelected(e)?this.deselectItem(e):this.selectItem(e)},isSelected:function(e){return this.selected.indexOf(e)>-1},inGallery:function(e){return"shortcode"!==this.modal_type&&"block"!==this.modal_type&&(!(!i.Gallery||!i.Gallery.media_ids)&&i.Gallery.media_ids.indexOf(e)>-1)},deselectItem:function(t,s){s&&s.preventDefault(),this.selected=e.grep(this.selected,e=>e!==t)},selectItem:function(e,t){t&&t.preventDefault(),this.multiselect?this.selected.push(e):this.selected=[e]},selectItemsTo:function(e,s){if(!this.multiselect||!this.selected_last)return void this.selectItem(e,s);s&&s.preventDefault();let i=this.media_ids.indexOf(this.selected_last),l=this.media_ids.indexOf(e),o=this.media_ids.slice(Math.min(i,l),Math.max(i,l)+1);this.selected=t.uniq(this.selected.concat(o))}}});i.ModalGallery=o}(jQuery,_,window.wp.i18n);
//# sourceMappingURL=editor-modal.min.js.map